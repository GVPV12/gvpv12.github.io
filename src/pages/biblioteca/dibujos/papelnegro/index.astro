---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';

// 1. Cargamos todas las imágenes de la carpeta de una vez
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/img/*.{jpeg,jpg,png,gif,webp}');

const galleryData = {
  title: 'Papel negro',
  slug: 'papelnegro',
  images: [
    { src: '/src/assets/img/aligned.webp', alt: 'Aligned', url: 'https://www.instagram.com/p/ejemplo1/' },
    { src: '/src/assets/img/catrina.webp', alt: 'Catrina', url: 'https://www.instagram.com/p/ejemplo2/' },
    { src: '/src/assets/img/shinyshoes.webp', alt: 'Shiny Shoes', url: 'https://www.instagram.com/p/ejemplo3/' },
    { src: '/src/assets/img/temporaryhigh.webp', alt: 'Temporary High', url: 'https://www.instagram.com/p/ejemplo4/' },
    { src: '/src/assets/img/timebroken.webp', alt: 'Time Broken', url: 'https://www.instagram.com/p/ejemplo5/' },
    { src: '/src/assets/img/practices.webp', alt: 'Practices', url: 'https://www.instagram.com/p/ejemplo6/' },
    { src: '/src/assets/img/breadclouds.webp', alt: 'Bread Clouds', url: 'https://www.instagram.com/p/ejemplo7/' },
    { src: '/src/assets/img/puertascielo.webp', alt: 'Puertas al Cielo', url: 'https://www.instagram.com/p/ejemplo8/' },
    { src: '/src/assets/img/foxinthenight.webp', alt: 'Fox in the Night', url: 'https://www.instagram.com/p/ejemplo9/' },
    { src: '/src/assets/img/jellyfishinthenight.webp', alt: 'Jellyfish in the Night', url: 'https://www.instagram.com/p/ejemplo10/' },
  ]
};

const { title, images } = galleryData;
---

<BaseLayout title={title} description={`Galería: ${title}`}>
  <div class="container">
    <main>
      <div class="mb-8">
        <a href="/biblioteca/dibujos/" class="text-cyan-400 hover:text-cyan-300 text-sm mb-4 inline-block">← Volver a Dibujos</a>
        <h1 class="text-3xl font-bold mb-2">{title}</h1>
      </div>
      
      <div class="gallery-grid">
        {images.map((image) => {
          // 2. Validamos que la imagen exista en nuestros assets
          if (!allImages[image.src]) {
             throw new Error(`"${image.src}" no se encuentra en /src/assets/img/`);
          }

          return (
            <a 
              href={image.url}
              target="_blank"
              rel="noopener noreferrer"
              class="gallery-item" 
              title={image.alt}
            >
              {/* 3. Usamos el componente Image llamando a la función del glob */}
              <Image src={allImages[image.src]()} alt={image.alt} width={500} height={500} />
              
              <div class="overlay">
                <span class="overlay-text">{image.alt}</span>
              </div>
            </a>
          );
        })}
      </div>
    </main>
  </div>
</BaseLayout>

<style>
  /* Tu CSS se mantiene igual, Astro lo aplicará al componente Image automáticamente */
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .gallery-item {
    position: relative;
    width: 100%;
    aspect-ratio: 1/1; /* Moderno: reemplaza el padding-bottom hack */
    overflow: hidden;
    border-radius: 0.5rem;
    background-color: #f0f0f0;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: block;
    text-decoration: none;
  }

  :global(.dark) .gallery-item {
    background-color: #2a2a2a;
  }

  .gallery-item:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: transform 0.3s ease;
  }

  /* ... resto de tu CSS (overlay, etc.) ... */
  .overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
    padding: 1.5rem 1rem 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .gallery-item:hover .overlay {
    opacity: 1;
  }

  .overlay-text {
    color: white;
    font-size: 0.875rem;
    font-weight: 600;
    display: block;
    text-align: center;
  }

  @media (max-width: 1024px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
  }
</style>