---
import BaseLayout from '../../../../layouts/BaseLayout.astro';

// Datos de ejemplo - reemplaza con tus datos reales
const galleryData = {
  title: 'Papel negro',
  slug: 'papelnegro',
  images: [
    { src: '/src/assets/img/aligned.webp', alt: 'Imagen 1', description: 'Descripción detallada de la imagen 1. Aquí puedes hablar sobre el proceso, inspiración, técnicas utilizadas, etc.' },
    { src: '/src/assets/img/catrina.webp', alt: 'Imagen 2', description: 'Descripción de la imagen 2.' },
    { src: '/src/assets/img/shinyshoes.webp', alt: 'Imagen 3', description: 'Descripción de la imagen 3.' },
    { src: '/src/assets/img/temporaryhigh.webp', alt: 'Imagen 4', description: 'Descripción de la imagen 4.' },
    { src: '/src/assets/img/timebroken.webp', alt: 'Imagen 5', description: 'Descripción de la imagen 5.' },
    { src: '/src/assets/img/practices.webp', alt: 'Imagen 6', description: 'Descripción de la imagen 6.' },
    { src: '/src/assets/img/breadclouds.webp', alt: 'Imagen 7', description: 'Descripción de la imagen 7.' },
    { src: '/src/assets/img/puertascielo.webp', alt: 'Imagen 8', description: 'Descripción de la imagen 8.' },
    { src: '/src/assets/img/foxinthenight.webp', alt: 'Imagen 9', description: 'Descripción de la imagen 9.' },
    { src: '/src/assets/img/jellyfishinthenight.webp', alt: 'Imagen 10', description: 'Descripción de la imagen 10.' },
  ]
};

const { title, images } = galleryData;
---

<BaseLayout title={title} description={`Galería: ${title}`}>
  <div class="container">
    <main>
      <div class="mb-8">
        <a href="/biblioteca/dibujos/" class="text-cyan-400 hover:text-cyan-300 text-sm mb-4 inline-block">← Volver a Dibujos</a>
        <h1 class="text-3xl font-bold mb-2">{title}</h1>
      </div>
      
      <div class="gallery-grid">
        {images.map((image, index) => (
          <button 
            class="gallery-item" 
            data-index={index}
            title={image.alt}
          >
            <img src={image.src} alt={image.alt} />
          </button>
        ))}
      </div>
    </main>
  </div>

  <!-- Modal/Popup -->
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Cerrar">×</button>
      <div class="modal-body">
        <div class="modal-image-container">
          <img id="modalImage" src="" alt="" />
        </div>
        <div class="modal-description">
          <h3 id="modalTitle" class="text-xl font-bold mb-4"></h3>
          <p id="modalDescription" class="text-sm text-zinc-700 dark:text-zinc-300"></p>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .gallery-item {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    overflow: hidden;
    border-radius: 0.5rem;
    background-color: #f0f0f0;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: none;
  }

  :global(.dark) .gallery-item {
    background-color: #2a2a2a;
  }

  .gallery-item:hover {
    transform: scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .gallery-item img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    overflow: auto;
  }

  .modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    position: relative;
    background-color: white;
    margin: auto;
    padding: 0;
    width: 90%;
    max-width: 1200px;
    max-height: 90vh;
    border-radius: 1rem;
    overflow: hidden;
  }

  :global(.dark) .modal-content {
    background-color: #1a1a1a;
  }

  .modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    color: white;
    background-color: rgba(0, 0, 0, 0.5);
    border: none;
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
  }

  .modal-close:hover {
    background-color: rgba(0, 0, 0, 0.8);
  }

  .modal-body {
    display: grid;
    grid-template-columns: 2fr 1fr;
    height: 100%;
    max-height: 90vh;
  }

  .modal-image-container {
    background-color: black;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .modal-image-container img {
    max-width: 100%;
    max-height: calc(90vh - 4rem);
    object-fit: contain;
  }

  .modal-description {
    padding: 2rem;
    overflow-y: auto;
    background-color: #f9f9f9;
  }

  :global(.dark) .modal-description {
    background-color: #2a2a2a;
  }

  @media (max-width: 1024px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .modal-body {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr auto;
    }

    .modal-description {
      max-height: 30vh;
    }
  }

  @media (max-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .modal-content {
      width: 95%;
    }
  }
</style>

<script define:vars={{ images }}>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalDescription = document.getElementById('modalDescription');
    const closeBtn = document.querySelector('.modal-close');
    const galleryItems = document.querySelectorAll('.gallery-item');

    function openModal(index) {
      const imageData = images[index];
      
      modalImage.src = imageData.src;
      modalImage.alt = imageData.alt;
      modalTitle.textContent = imageData.alt;
      modalDescription.textContent = imageData.description;
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      // Limpiar la imagen para evitar problemas
      setTimeout(() => {
        if (!modal.classList.contains('active')) {
          modalImage.src = '';
        }
      }, 300);
    }

    galleryItems.forEach((item) => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const index = parseInt(item.dataset.index);
        openModal(index);
      });
    });

    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      closeModal();
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  });
</script>