---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';

// Cargamos todas las imágenes
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/img/*.{jpeg,jpg,png,gif,webp}');

const galleryData = {
  title: 'Papel negro',
  slug: 'papelnegro',
  images: [
    { src: '/src/assets/img/aligned.webp', alt: 'Imagen 1', description: 'Descripción detallada de la imagen 1. Aquí puedes hablar sobre el proceso, inspiración, técnicas utilizadas, etc.' },
    { src: '/src/assets/img/catrina.webp', alt: 'Imagen 2', description: 'Descripción de la imagen 2.' },
    { src: '/src/assets/img/shinyshoes.webp', alt: 'Imagen 3', description: 'Descripción de la imagen 3.' },
    { src: '/src/assets/img/temporaryhigh.webp', alt: 'Imagen 4', description: 'Descripción de la imagen 4.' },
    { src: '/src/assets/img/timebroken.webp', alt: 'Imagen 5', description: 'Descripción de la imagen 5.' },
    { src: '/src/assets/img/practices.webp', alt: 'Imagen 6', description: 'Descripción de la imagen 6.' },
    { src: '/src/assets/img/breadclouds.webp', alt: 'Imagen 7', description: 'Descripción de la imagen 7.' },
    { src: '/src/assets/img/puertascielo.webp', alt: 'Imagen 8', description: 'Descripción de la imagen 8.' },
    { src: '/src/assets/img/foxinthenight.webp', alt: 'Imagen 9', description: 'Descripción de la imagen 9.' },
    { src: '/src/assets/img/jellyfishinthenight.webp', alt: 'Imagen 10', description: 'Descripción de la imagen 10.' },
  ]
};

const { title, images } = galleryData;
---

<BaseLayout title={title} description={`Galería: ${title}`}>
  <div class="container">
    <main>
      <div class="mb-8">
        <a href="/biblioteca/dibujos/" class="text-cyan-400 hover:text-cyan-300 text-sm mb-4 inline-block">← Volver a Dibujos</a>
        <h1 class="text-3xl font-bold mb-2">{title}</h1>
      </div>
      
      <div class="gallery-grid">
        {images.map((image) => (
          <div 
            class="gallery-item" 
            data-src={image.src} 
            data-alt={image.alt} 
            data-desc={image.description}
          >
            <Image src={allImages[image.src]()} alt={image.alt} width={500} height={500} />
            <div class="overlay">
              <span class="overlay-text">{image.alt}</span>
            </div>
          </div>
        ))}
      </div>
    </main>
  </div>

  <dialog id="image-modal" class="modal">
    <div class="modal-content">
      <button id="close-modal" class="close-btn" aria-label="Cerrar">&times;</button>
      
      <div class="modal-body">
        <div class="image-container">
          <img id="modal-img" src="" alt="" />
        </div>
        <div class="info-container">
          <h2 id="modal-title"></h2>
          <p id="modal-desc"></p>
        </div>
      </div>
    </div>
  </dialog>
</BaseLayout>

<script>
  const modal = document.getElementById('image-modal') as HTMLDialogElement;
  const closeBtn = document.getElementById('close-modal');
  const modalImg = document.getElementById('modal-img') as HTMLImageElement;
  const modalTitle = document.getElementById('modal-title');
  const modalDesc = document.getElementById('modal-desc');
  const galleryItems = document.querySelectorAll('.gallery-item');

  galleryItems.forEach(item => {
    item.addEventListener('click', () => {
      const src = item.getAttribute('data-src');
      const alt = item.getAttribute('data-alt');
      const desc = item.getAttribute('data-desc');

      // En el modal usamos la imagen ya procesada por Astro que está en el DOM
      const imgInDoc = item.querySelector('img');
      if (imgInDoc && modal) {
        modalImg.src = imgInDoc.src;
        modalTitle!.textContent = alt;
        modalDesc!.textContent = desc || "Sin descripción disponible.";
        modal.showModal();
      }
    });
  });

  closeBtn?.addEventListener('click', () => modal.close());
  
  // Cerrar al hacer click fuera del contenido
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) modal.close();
  });
</script>

<style>
  .container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
  }

  .gallery-item {
    position: relative;
    aspect-ratio: 1/1;
    overflow: hidden;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .gallery-item:hover { transform: scale(1.02); }

  .gallery-item img { width: 100%; height: 100%; object-fit: cover; }

  /* --- ESTILOS DEL MODAL --- */
  .modal {
    padding: 0;
    border: none;
    border-radius: 0.75rem;
    background: transparent;
    max-width: 90vw;
    max-height: 90vh;
  }

  .modal::backdrop {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    background: #18181b; /* Zinc 900 */
    color: white;
    position: relative;
    display: flex;
    flex-direction: column;
    border-radius: 0.75rem;
    overflow: hidden;
  }

  .close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    font-size: 2rem;
    line-height: 1;
    padding: 0.2rem 0.6rem;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: background 0.2s;
  }

  .close-btn:hover { background: rgba(255,255,255,0.2); }

  .modal-body {
    display: flex;
    flex-direction: row;
    height: 80vh;
  }

  .image-container {
    flex: 2;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .image-container img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  .info-container {
    flex: 1;
    padding: 2.5rem;
    min-width: 300px;
    border-left: 1px solid #27272a;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  #modal-title { font-size: 1.5rem; font-weight: bold; color: #22d3ee; }
  #modal-desc { color: #d4d4d8; line-height: 1.6; }

  /* Responsive para el modal */
  @media (max-width: 768px) {
    .modal-body { flex-direction: column; height: auto; }
    .info-container { border-left: none; border-top: 1px solid #27272a; padding: 1.5rem; }
  }

  /* Overlay original */
  .overlay {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.8));
    padding: 1rem; opacity: 0; transition: opacity 0.3s;
  }
  .gallery-item:hover .overlay { opacity: 1; }
</style>